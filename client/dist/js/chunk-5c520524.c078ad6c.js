(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5c520524"],{"293a":function(e,t,s){"use strict";s.r(t);var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"chat"}},[s("div",{staticClass:"header"},[s("h4",[s("div",{staticClass:"title"},[e._v("Conversation with "),s("span",[e._v(e._s(e.chatMembers[1]?e.chatMembers[1].username:""))])]),s("div",{staticClass:"info"},e._l(e.info,(function(t,n){return s("p",{key:n},[e._v(" "+e._s(t.username)+" "+e._s(t.type)+" ")])})),0)])]),s("div",{staticClass:"body"},[s("ul",{staticClass:"messages"},e._l(e.messages,(function(t,n){return s("li",{key:n},[s("span",{style:{"float-left":1===t.type}},[e._v(" "+e._s(t.message)+" "),s("small",[e._v(":"+e._s(t.user))])])])})),0)]),s("div",{staticClass:"footer"},[s("form",{on:{submit:function(t){return t.preventDefault(),e.send(t)}}},[s("div",{staticClass:"form-wrapper"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.newMessage,expression:"newMessage"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Enter message here"},domProps:{value:e.newMessage},on:{keydown:function(t){return e.typeAction(!0)},keyup:function(t){return e.typeAction(!1)},input:function(t){t.target.composing||(e.newMessage=t.target.value)}}}),s("div",{staticClass:"button send-button",on:{click:e.send}},[e._v("send")])])]),e.typing?s("small",{staticClass:"text-white"},[e._v(e._s(e.typing)+" is typing")]):e._e()])])},i=[],r=(s("4de4"),s("7db0"),s("4160"),s("159b"),s("96cf"),s("1da1")),o=s("5530"),a=s("2f62"),c={data:function(){return{newMessage:null,messages:[],typing:!1,username:null,info:[],connections:0,chatId:"",chatMembers:[]}},created:function(){var e=this;this.user.username&&this.setMembers(),window.onbeforeunload=function(){e.$ioEmit("leave",e.user.username)},this.$ioOn("chat-message",(function(t){var s=e.chatMembers.find((function(e){return e.uid==t.from}));s&&e.messages.push({message:t.message,type:1,user:t.user}),e.$nextTick((function(){document.querySelector(".body").scrollIntoView()}))})),this.$ioOn("typing",(function(t){var s=e.chatMembers.find((function(e){return e.uid==t.from}));s&&(e.typing=s.username+" is typing")})),this.$ioOn("stopTyping",(function(){e.typing=!1}))},watch:{user:function(e){e.username&&this.setMembers()},conversations:function(){(this.chatMembers.length>=0||this.chatMembers.length<=1)&&this.setMembers()},chatMembers:function(){if(!(this.chatMembers<=1)){var e=this,t=this.$db.collection("messages");this.chatMembers.forEach((function(e){e&&(t=t.where("members."+e.uid,"==",!0))})),t.get().then((function(t){var s=[];t.forEach((function(e){var t=Object(o["a"])({id:e.id},e.data());s.push(t)})),e.messages=s,e.$nextTick((function(){e.scrollWindow()}))})).catch((function(e){console.log("Error getting documents: ",e)}))}}},computed:Object(o["a"])(Object(o["a"])({},Object(a["b"])(["conversations","user"])),{},{getAddresses:function(){var e=this;return this.chatMembers.filter((function(t){return e.user.id!=t.id}))}}),methods:{typeAction:function(e){var t=this;this.getAddresses.forEach((function(s){s.id!==t.user.id&&(e?t.$ioEmit("typing",{address:s.uid,from:t.user.uid}):t.$ioEmit("stopTyping",{address:s.uid,from:t.user.uid}))}))},setMembers:function(){var e,t=this;this.chatMembers=[],this.chatMembers.push(this.user),this.chatId=this.$route.query.id,this.chatId?e=this.conversations.find((function(e){return e.id==t.chatId})):(e=this.conversations.find((function(e){return e.admin&&e.online})),e||(e=this.conversations.find((function(e){return e.admin})))),this.chatMembers.push(e)},send:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.current="",e.messages.push({message:e.newMessage,type:0,user:e.user.username}),e.$nextTick((function(){e.scrollWindow()})),s={message:e.newMessage,user:e.user.username},s.members={},e.chatMembers.forEach((function(e){s.members[e.uid]=!0})),e.$db.collection("messages").add(s).then((function(e){console.log("Document written with ID: ",e.id)})).catch((function(e){console.error("Error adding document: ",e)})),e.chatMembers.forEach((function(t){t.id!==e.user.id&&(s.address=t.uid,s.from=e.user.uid,e.$ioEmit("chat-message",s))})),e.newMessage=null;case 9:case"end":return t.stop()}}),t)})))()},scrollWindow:function(){var e=document.scrollingElement||document.body;e.scrollTop=e.scrollHeight}}},u=c,d=(s("9c66"),s("2877")),h=Object(d["a"])(u,n,i,!1,null,null,null);t["default"]=h.exports},"7db0":function(e,t,s){"use strict";var n=s("23e7"),i=s("b727").find,r=s("44d2"),o=s("ae40"),a="find",c=!0,u=o(a);a in[]&&Array(1)[a]((function(){c=!1})),n({target:"Array",proto:!0,forced:c||!u},{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),r(a)},8264:function(e,t,s){},"9c66":function(e,t,s){"use strict";var n=s("8264"),i=s.n(n);i.a}}]);
//# sourceMappingURL=chunk-5c520524.c078ad6c.js.map